<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© - Ø§Ù„Ø·Ù„Ø¨Ø§Øª</title>
  <link rel="stylesheet" href="../../CSS/Admin-Css/Orders.css">
  <style>
    button {
      padding: 5px 10px;
      margin: 2px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button.confirm { background-color: #4CAF50; color: white; }
    button.delete { background-color: #f44336; color: white; }
  </style>
</head>
<body>
  <h1>ğŸ“‹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h1>

  <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†ØŒ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">

  <table>
    <thead>
      <tr>
        <th>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
        <th>Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†</th>
        <th>ğŸ“§ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</th>
        <th>ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ</th>
        <th>ğŸ  Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
        <th>ğŸ›’ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªÙˆØ¬</th>
        <th>ğŸ’² Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©</th>
        <th>ğŸ“¦ Ø§Ù„ÙƒÙ…ÙŠØ©</th>
        <th>ğŸ’° Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
        <th>ğŸ—“ï¸ Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
        <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
      </tr>
    </thead>
    <tbody id="ordersTable">
      <tr><td colspan="12">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</td></tr>
    </tbody>
  </table>

  <script>
    const ordersTable = document.getElementById("ordersTable");
    const searchInput = document.getElementById("searchInput");
    let allOrders = [];

    async function loadOrders() {
      try {
        const res = await fetch("/orders");
        if (!res.ok) throw new Error("ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª");
        allOrders = await res.json();
        displayOrders(allOrders);
      } catch (err) {
        console.error(err);
        ordersTable.innerHTML = "<tr><td colspan='12'>âš  Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</td></tr>";
      }
    }

    function displayOrders(orders) {
      if (!orders.length) {
        ordersTable.innerHTML = "<tr><td colspan='12'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</td></tr>";
        return;
      }

      ordersTable.innerHTML = "";
      orders.forEach(order => {
        const tr = document.createElement("tr");
const date = new Date(order.created_at).toLocaleString('en-GB', {
  year: 'numeric', month: '2-digit', day: '2-digit',
  hour: '2-digit', minute: '2-digit'
});

        tr.innerHTML = `
          <td data-label="Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨">${order.id}</td>
          <td data-label="Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†">${order.customer_name}</td>
          <td data-label="Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„">${order.customer_email || '-'}</td>
          <td data-label="Ø§Ù„Ù‡Ø§ØªÙ">${order.customer_phone}</td>
          <td data-label="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†">${order.customer_address}</td>
          <td data-label="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªÙˆØ¬">${order.product_name}</td>
          <td data-label="Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©">${order.product_price} Ø¯Ø¬</td>
          <td data-label="Ø§Ù„ÙƒÙ…ÙŠØ©">${order.quantity || 1}</td>
          <td data-label="Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ">${order.total_price} Ø¯Ø¬</td>
          <td data-label="Ø§Ù„ØªØ§Ø±ÙŠØ®">${date}</td>
          <td data-label="Ø§Ù„Ø­Ø§Ù„Ø©" class="${order.status === 'confirmed' ? 'confirmed' : 'pending'}">
            ${order.status === 'confirmed' ? 'âœ… Ù…Ø¤ÙƒØ¯' : 'â³ Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±'}
          </td>
          <td data-label="Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª">
            ${order.status === 'confirmed' 
              ? `<button class="delete" onclick="deleteOrder(${order.id})">Ø­Ø°Ù</button>` 
              : `<button class="confirm" onclick="confirmOrder(${order.id})">ØªØ£ÙƒÙŠØ¯</button>
                 <button class="delete" onclick="deleteOrder(${order.id})">Ø­Ø°Ù</button>`}
          </td>
        `;
        ordersTable.appendChild(tr);
      });
    }

    async function confirmOrder(orderId) {
      try {
        const res = await fetch(`/orders/${orderId}/confirm`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" }
        });
        if (!res.ok) throw new Error("ÙØ´Ù„ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨");
        await loadOrders();
        alert("âœ… ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­");
      } catch (err) {
        alert("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨");
        console.error(err);
      }
    }

    async function deleteOrder(orderId) {
      if (!confirm("âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ")) return;

      try {
        const res = await fetch(`/orders/${orderId}`, {
          method: "DELETE"
        });
        if (!res.ok) throw new Error("ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨");
        await loadOrders();
        alert("ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­");
      } catch (err) {
        alert("âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨");
        console.error(err);
      }
    }

    // ÙÙ„ØªØ±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„Ù…Ù†ØªØ¬ Ø£Ùˆ Ø§Ù„Ù‡Ø§ØªÙ
    searchInput.addEventListener("input", () => {
      const query = searchInput.value.toLowerCase();
      const filtered = allOrders.filter(order =>
        order.customer_name.toLowerCase().includes(query) ||
        order.product_name.toLowerCase().includes(query) ||
        (order.customer_phone && order.customer_phone.includes(query))
      );
      displayOrders(filtered);
    });

    loadOrders();
  </script>
</body>
</html>

